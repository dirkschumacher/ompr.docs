<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Warehouse Location Problem • ompr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">ompr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Overview</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dirkschumacher/ompr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>The Warehouse Location Problem</h1>
                        <h4 class="author">Dirk Schumacher</h4>
            
            <h4 class="date">2017-03-05</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#introduction" class="anchor"> </a></body></html>Introduction</h2>
<p>In this article we will look at the <a href="https://en.wikipedia.org/wiki/Facility_location_problem">Warehouse Location Problem</a>. Given a set of customers and set of locations to build warehoses the task is to decide where to build warehouses and from what warehouses goods should be shipped to which customer.</p>
<p>Thus there are two decisions that need to made at once: where and if to build warehouses and the assignment of customers to warehouses. This simple setting also implies that at least one warehouse must be built and that any warehouse is big enough to serve all customers.</p>
<p>As a practical example: you run the logistics for an NGO and want to regularly distribute goods to people in need. You identified a set of possible locations to set up your distribution hubs, but you are not sure where to build them. Then such a model might help. In practice however you might need to incorporate additional constraints into the model.</p>
</div>
<div id="the-mathematical-model" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#the-mathematical-model" class="anchor"> </a></body></html>The mathematical model</h2>
<p>We start with a set of customers <span class="math inline">\(C = \{1 \ldots n\}\)</span> and a set of possible warehouses <span class="math inline">\(W = \{1 \ldots m\}\)</span> that could be built. In addition we have a cost function giving us the transportation cost from a warehouse to a customer. Furthermore there is a fixed cost associated with each warehouse if it will be built. This basic version of the warehouse location problem is adopted from the <a href="https://de.wikipedia.org/wiki/Warehouse_Location_Problem">German Wikipedia page</a> about the problem.</p>
<p><span class="math display">\[
\begin{equation*}
\begin{array}{ll@{}ll}
\text{min}  &amp; \displaystyle\sum\limits_{i=1}^{n}\sum\limits_{j=1}^{m}\operatorname{transportcost}_{i,j} \cdot x_{i, j} +  \sum\limits_{j=1}^{m}\operatorname{fixedcost}_{j} \cdot y_{j}&amp; &amp;\\
\text{subject to} &amp; \displaystyle\sum\limits_{j=1}^{m}   x_{i, j} = 1  &amp; i=1 ,\ldots, n&amp;\\
                  &amp; \displaystyle x_{i, j} \leq y_j,  &amp; i=1 ,\ldots, n &amp; j=1 ,\ldots, m&amp;\\
                 &amp;                                                x_{i,j} \in \{0,1\} &amp;i=1 ,\ldots, n, &amp; j=1 ,\ldots, m \\
                 &amp;                                                y_{j} \in \{0,1\} &amp;j=1 ,\ldots, m&amp;
\end{array}
\end{equation*}
\]</span></p>
</div>
<div id="the-model-in-r" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#the-model-in-r" class="anchor"> </a></body></html>The model in R</h2>
<p>The first thing we need is the data. In this article we will simply generate artificial data.</p>
<p>We assume the <strong>customers</strong> are located in a grid with euclidian distances:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
grid_size &lt;-<span class="st"> </span><span class="dv">1000</span>
n &lt;-<span class="st"> </span><span class="dv">100</span>
customer_locations &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">id =</span> <span class="dv">1</span>:n,
  <span class="dt">x =</span> <span class="kw">round</span>(<span class="kw">runif</span>(n) *<span class="st"> </span>grid_size),
  <span class="dt">y =</span> <span class="kw">round</span>(<span class="kw">runif</span>(n) *<span class="st"> </span>grid_size)
)</code></pre></div>
<p>The <strong>warehouses</strong> are also randomly placed on the grid. The fixed cost for the warehouses are randomly generated as well with mean cost of 10,000.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="dv">20</span>
warehouse_locations &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">id =</span> <span class="dv">1</span>:m,
  <span class="dt">x =</span> <span class="kw">round</span>(<span class="kw">runif</span>(m) *<span class="st"> </span>grid_size),
  <span class="dt">y =</span> <span class="kw">round</span>(<span class="kw">runif</span>(m) *<span class="st"> </span>grid_size)
)
fixedcost &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rnorm</span>(m, <span class="dt">mean =</span> grid_size *<span class="st"> </span><span class="dv">10</span>, <span class="dt">sd =</span> grid_size *<span class="st"> </span><span class="dv">5</span>))</code></pre></div>
<p>The fixed costs to set up a warehouse are the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fixedcost</code></pre></div>
<pre><code>##  [1]  9043  6090 20291 13753 19121 10400  6843  2434  6820 11132 15068
## [12] 11264  4140 13344  1749  8171  8419   259 14600  6886</code></pre>
<p>Next step is to build a functions that takes a customer and a warehouse and returns the transport cost.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">transportcost &lt;-<span class="st"> </span>function(i, j) {
  customer &lt;-<span class="st"> </span>customer_locations[i, ]
  warehouse &lt;-<span class="st"> </span>warehouse_locations[j, ]
  <span class="kw">round</span>(<span class="kw">sqrt</span>((customer$x -<span class="st"> </span>warehouse$x)^<span class="dv">2</span> +<span class="st"> </span>(customer$y -<span class="st"> </span>warehouse$y)^<span class="dv">2</span>))
}
<span class="kw">transportcost</span>(<span class="dv">1</span>, <span class="dv">3</span>)</code></pre></div>
<pre><code>## [1] 302</code></pre>
<p>Now let’s plot everything. Black dots are customers and red dots are possible warehouse locations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(customer_locations, <span class="kw">aes</span>(x, y)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> warehouse_locations, <span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">shape =</span> <span class="dv">17</span>) +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, grid_size)) +
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, grid_size)) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())
p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Warehouse location problem"</span>, 
          <span class="st">"Black dots are customers. Light red triangles show potential warehouse locations."</span>)</code></pre></div>
<p><img src="problem-warehouse-location_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>The model in <code>ompr</code> then looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ompr)
<span class="kw">library</span>(magrittr)
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/MIPModel.html">MIPModel</a></span>() %&gt;%
<span class="st">  </span><span class="co"># 1 iff i gets assigned to warehouse j</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_variable.html">add_variable</a></span>(x[i, j], <span class="dt">i =</span> <span class="dv">1</span>:n, <span class="dt">j =</span> <span class="dv">1</span>:m, <span class="dt">type =</span> <span class="st">"binary"</span>) %&gt;%
<span class="st">  </span>
<span class="st">  </span><span class="co"># 1 iff warehouse j is built</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_variable.html">add_variable</a></span>(y[j], <span class="dt">j =</span> <span class="dv">1</span>:m, <span class="dt">type =</span> <span class="st">"binary"</span>) %&gt;%
<span class="st">  </span>
<span class="st">  </span><span class="co"># maximize the preferences</span>
<span class="st">  </span><span class="kw"><a href="../reference/set_objective.html">set_objective</a></span>(<span class="kw"><a href="../reference/sum_expr.html">sum_expr</a></span>(<span class="kw">transportcost</span>(i, j) *<span class="st"> </span>x[i, j], <span class="dt">i =</span> <span class="dv">1</span>:n, <span class="dt">j =</span> <span class="dv">1</span>:m) +<span class="st"> </span>
<span class="st">                  </span><span class="kw"><a href="../reference/sum_expr.html">sum_expr</a></span>(fixedcost[j] *<span class="st"> </span>y[j], <span class="dt">j =</span> <span class="dv">1</span>:m), <span class="st">"min"</span>) %&gt;%
<span class="st">  </span>
<span class="st">  </span><span class="co"># every customer needs to be assigned to a warehouse</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_constraint.html">add_constraint</a></span>(<span class="kw"><a href="../reference/sum_expr.html">sum_expr</a></span>(x[i, j], <span class="dt">j =</span> <span class="dv">1</span>:m) ==<span class="st"> </span><span class="dv">1</span>, <span class="dt">i =</span> <span class="dv">1</span>:n) %&gt;%<span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># if a customer is assigned to a warehouse, then this warehouse must be built</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_constraint.html">add_constraint</a></span>(x[i,j] &lt;=<span class="st"> </span>y[j], <span class="dt">i =</span> <span class="dv">1</span>:n, <span class="dt">j =</span> <span class="dv">1</span>:m)
model</code></pre></div>
<pre><code>## Mixed linear integer optimization problem
## Variables:
##   Continuous: 0 
##   Integer: 0 
##   Binary: 2020 
## Search direction: minimize 
## Constraints: 2100</code></pre>
</div>
<div id="solve-the-model" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#solve-the-model" class="anchor"> </a></body></html>Solve the model</h2>
<p>We will use <code>glpk</code> to solve the above model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ompr.roi)
<span class="kw">library</span>(ROI.plugin.glpk)
result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/solve_model.html">solve_model</a></span>(model, <span class="kw">with_ROI</span>(<span class="dt">solver =</span> <span class="st">"glpk"</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## &lt;SOLVER MSG&gt;  ----
## GLPK Simplex Optimizer, v4.60
## 2100 rows, 2020 columns, 6000 non-zeros
##       0: obj =   0.000000000e+00 inf =   1.000e+02 (100)
##     120: obj =   5.223300000e+04 inf =   0.000e+00 (0)
## *   500: obj =   5.223300000e+04 inf =   0.000e+00 (110) 2
## *   856: obj =   3.322200000e+04 inf =   0.000e+00 (0) 1
## OPTIMAL LP SOLUTION FOUND
## GLPK Integer Optimizer, v4.60
## 2100 rows, 2020 columns, 6000 non-zeros
## 2020 integer variables, all of which are binary
## Integer optimization begins...
## +   856: mip =     not found yet &gt;=              -inf        (1; 0)
## +   856: &gt;&gt;&gt;&gt;&gt;   3.322200000e+04 &gt;=   3.322200000e+04   0.0% (1; 0)
## +   856: mip =   3.322200000e+04 &gt;=     tree is empty   0.0% (0; 1)
## INTEGER OPTIMAL SOLUTION FOUND
## &lt;!SOLVER MSG&gt; ----</code></pre>
<p>We solved the problem with an objective value of 33222.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(dplyr))
matching &lt;-<span class="st"> </span>result %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/get_solution.html">get_solution</a></span>(x[i,j]) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(value &gt;<span class="st"> </span>.<span class="dv">9</span>) %&gt;%<span class="st">  </span>
<span class="st">  </span><span class="kw">select</span>(i, j)</code></pre></div>
<p>The last step is to add the assignments to the previous plot we generated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_assignment &lt;-<span class="st"> </span>matching %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(customer_locations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"i"</span> =<span class="st"> "id"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(warehouse_locations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"j"</span> =<span class="st"> "id"</span>))
customer_count &lt;-<span class="st"> </span>matching %&gt;%<span class="st"> </span><span class="kw">group_by</span>(j) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) %&gt;%<span class="st"> </span><span class="kw">rename</span>(<span class="dt">id =</span> j)
plot_warehouses &lt;-<span class="st"> </span>warehouse_locations %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">costs =</span> fixedcost) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(customer_count, <span class="dt">by =</span> <span class="st">"id"</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(id %in%<span class="st"> </span><span class="kw">unique</span>(matching$j))
p +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> plot_assignment, <span class="kw">aes</span>(<span class="dt">x =</span> x.y, <span class="dt">y =</span> y.y, <span class="dt">xend =</span> x.x, <span class="dt">yend =</span> y.x)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data  =</span> plot_warehouses, <span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">shape =</span> <span class="dv">17</span>) +
<span class="st">  </span>ggrepel::<span class="kw">geom_label_repel</span>(<span class="dt">data  =</span> plot_warehouses, 
                            <span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">paste0</span>(<span class="st">"fixed costs:"</span>, costs, <span class="st">"; customers: "</span>, n)), 
                            <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">nudge_y =</span> <span class="dv">20</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="st">"Cost optimal warehouse locations and customer assignment"</span>),
          <span class="st">"Big red triangles show warehouses that will be built, light red are unused warehouse locations. </span>
<span class="st">Dots represent customers served by the respective warehouses."</span>)</code></pre></div>
<p><img src="problem-warehouse-location_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>The fixed costs for setting up the 4 warehouses is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(fixedcost[<span class="kw">unique</span>(matching$j)])</code></pre></div>
<pre><code>## [1] 11285</code></pre>
</div>
<div id="feedback" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#feedback" class="anchor"> </a></body></html>Feedback</h2>
<p>Do you have any questions, ideas, comments? Or did you find a mistake? Let’s discuss on <a href="https://github.com/dirkschumacher/ompr/issues">Github</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#the-mathematical-model">The mathematical model</a></li>
      <li><a href="#the-model-in-r">The model in R</a></li>
      <li><a href="#solve-the-model">Solve the model</a></li>
      <li><a href="#feedback">Feedback</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Dirk Schumacher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
